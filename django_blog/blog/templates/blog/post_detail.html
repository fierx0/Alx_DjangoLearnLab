{% extends "blog/base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
  <article>
    <h2>{{ post.title }}</h2>
    <p class="meta">by {{ post.author }} • {{ post.published_date|date:"Y-m-d H:i" }}</p>
    <div class="content">{{ post.content|linebreaks }}</div>
  </article>

  {% if user.is_authenticated and user.id == post.author_id %}
    <p>
      <a href="{% url 'blog:post_update' post.pk %}">✏️ Edit</a> •
      <a href="{% url 'blog:post_delete' post.pk %}">🗑️ Delete</a>
    </p>
  {% endif %}

  <hr>

  <section id="comments">
    <h3>Comments ({{ comments|length }})</h3>

    {% if comments %}
      <ul class="comment-list">
        {% for c in comments %}
          <li class="comment-item">
            <p class="comment-meta">
              <strong>{{ c.author }}</strong> • {{ c.created_at|date:"Y-m-d H:i" }}
              {% if c.updated_at and c.updated_at > c.created_at %}<em>(edited)</em>{% endif %}
            </p>
            <p class="comment-body">{{ c.content|linebreaks }}</p>
            {% if user.is_authenticated and user.id == c.author_id %}
              <p class="comment-actions">
                <a href="{% url 'blog:comment_update' c.pk %}">Edit</a> •
                <a href="{% url 'blog:comment_delete' c.pk %}">Delete</a>
              </p>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No comments yet.</p>
    {% endif %}

    {% if user.is_authenticated %}
      <h4>Add a comment</h4>
      <form method="post" action="{% url 'blog:comment_create' post_id=post.pk %}" novalidate>
        {% csrf_token %}
        {{ comment_form.non_field_errors }}
        <p>{{ comment_form.content }} {{ comment_form.content.errors }}</p>
        <button type="submit">Post comment</button>
      </form>
    {% else %}
      <p><a href="{% url 'blog:login' %}">Log in</a> to comment.</p>
    {% endif %}
  </section>

  <p><a href="{% url 'blog:post_list' %}">← Back to posts</a></p>
{% endblock %}
